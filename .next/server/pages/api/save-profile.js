"use strict";(()=>{var e={};e.id=508,e.ids=[508],e.modules={6718:e=>{e.exports=require("canvas")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1121:e=>{e.exports=require("qrcode")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},3607:(e,t,o)=>{o.r(t),o.d(t,{config:()=>v,default:()=>h,routeModule:()=>w});var r={};o.r(r),o.d(r,{config:()=>m,default:()=>b});var n=o(1802),a=o(7153),i=o(6249),s=o(188),l=o(9489),c=o(1121),u=o.n(c),d=o(2048),p=o.n(d),f=o(5315),P=o.n(f),g=o(6718);let m={api:{bodyParser:!1}};function b(e,t){let o=new Date().toLocaleDateString();console.log("formattedDateTime",o),l.Z.fields([{name:"profilePicture",maxCount:1},{name:"backgroundPhoto",maxCount:1}])(e,{},async r=>{if(r)return t.status(500).send(r);let{name:n,address:a,email:i,userName:l,mobile:c,whatsapp:d,facebook:f,instagram:m,twitter:b,designation:h,companyName:v,companyLocation:w,website:A,linkedin:S}=e.body,x=e.files.profilePicture[0].filename,y=e.files.backgroundPhoto[0].filename;console.log("profilePicture",x),console.log("backgroundPhoto",y);let E=`${process.env.BASE_URL}/${l}`,q=`${Date.now()}-qr.png`;P().join(process.cwd(),"public",q),P().join(process.cwd(),"/uploads",x);try{let e=await u().toBuffer(E,{errorCorrectionLevel:"H",width:900}),r=(0,g.createCanvas)(350,350),_=r.getContext("2d");_.fillStyle="white",_.fillRect(0,0,r.width,r.height),_.font="bold 24px Arial",_.fillStyle="black",_.textAlign="center",_.fillText(n,r.width/2,80);let D=await (0,g.loadImage)(e);_.drawImage(D,10,80,330,285);let k=P().join(process.cwd(),"public",q),R=p().createWriteStream(k);r.createPNGStream().pipe(R),R.on("finish",async()=>{await s.Z.query(`INSERT INTO users (
                        name, 
                        userName,
                        address, 
                        email, 
                        mobile, 
                        whatsapp, 
                        facebook, 
                        instagram, 
                        twitter, 
                        designation, 
                        companyName, 
                        companyLocation,
                        website, 
                        linkedin, 
                        profilePicture, 
                        qrCode,
                        backgroundPhoto,
                        registrationDate 
                    ) VALUES (?, ?, ?,?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?)`,[n,l,a,i,c,d,f,m,b,h,v,w,A,S,x,q,y,o]),t.status(200).json({message:"Profile saved and QR code generated!",success:!0})})}catch(e){console.error(e),t.status(500).json({error:"Error generating QR code or saving profile"})}})}let h=(0,i.l)(r,"default"),v=(0,i.l)(r,"config"),w=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/save-profile",pathname:"/api/save-profile",bundlePath:"",filename:""},userland:r})},9489:(e,t,o)=>{o.d(t,{Z:()=>i});let r=require("multer");var n=o.n(r);let a=n().diskStorage({destination:function(e,t,o){o(null,"./public/uploads")},filename:function(e,t,o){o(null,Date.now()+"-"+t.originalname)}}),i=n()({storage:a})},188:(e,t,o)=>{o.d(t,{Z:()=>a});let r=require("mysql2/promise"),n=o.n(r)().createPool({host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME});(async function(){try{await n.getConnection(),console.log("Connected to the database")}catch(e){console.error("Failed to connect to the database ==>",e)}})();let a=n},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=3607);module.exports=o})();