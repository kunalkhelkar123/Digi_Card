"use strict";(()=>{var e={};e.id=648,e.ids=[648],e.modules={6718:e=>{e.exports=require("canvas")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1121:e=>{e.exports=require("qrcode")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},1145:(e,r,t)=>{t.r(r),t.d(r,{config:()=>w,default:()=>b,routeModule:()=>A});var o={};t.r(o),t.d(o,{config:()=>P,default:()=>m});var s=t(1802),n=t(7153),a=t(6249),i=t(188),u=t(9489),l=t(1121),p=t.n(l),d=t(2048),c=t.n(d),f=t(5315),h=t.n(f),g=t(6718);let P={api:{bodyParser:!1}};function m(e,r){u.Z.fields([{name:"profilePicture",maxCount:1},{name:"backgroundPhoto",maxCount:1}])(e,{},async t=>{if(t)return r.status(500).send(t);let{id:o,name:s,userName:n,address:a,email:u,mobile:l,whatsapp:d,facebook:f,instagram:P,twitter:m,designation:b,companyName:w,website:A,linkedin:v}=e.body,E=null,x=null;e.files.profilePicture&&e.files.profilePicture[0]?E=e.files.profilePicture[0].filename:console.warn("No profile picture uploaded."),e.files.backgroundPhoto&&e.files.backgroundPhoto[0]?x=e.files.backgroundPhoto[0].filename:console.warn("No background photo uploaded.");let y=`${process.env.BASE_URL}/${s}`,S=`uploads/${Date.now()}-${s}-qr.png`;if(h().join(process.cwd(),"public",S),!o)return console.error("User ID is required"),r.status(400).json({message:"User ID is required."});let q=[],j=[];if(s&&(q.push("name = ?"),j.push(s)),n&&(q.push("userName = ?"),j.push(n)),a&&(q.push("address = ?"),j.push(a)),u&&(q.push("email = ?"),j.push(u)),l&&(q.push("mobile = ?"),j.push(l)),d&&(q.push("whatsapp = ?"),j.push(d)),f&&(q.push("facebook = ?"),j.push(f)),P&&(q.push("instagram = ?"),j.push(P)),m&&(q.push("twitter = ?"),j.push(m)),b&&(q.push("designation = ?"),j.push(b)),w&&(q.push("companyName = ?"),j.push(w)),A&&(q.push("website = ?"),j.push(A)),E&&(q.push("profilePicture = ?"),j.push(E)),x&&(q.push("backgroundPhoto = ?"),j.push(x)),v&&(q.push("linkedin = ?"),j.push(v)),0===q.length)return console.warn("No fields to update."),r.status(400).json({message:"No fields to update."});j.push(o);try{let e=await p().toBuffer(y),t=(0,g.createCanvas)(400,600),o=t.getContext("2d");if(E){let e=h().join(process.cwd(),"public/uploads",E),r=await (0,g.loadImage)(e);o.drawImage(r,100,20,200,200)}o.font="bold 24px Arial",o.fillStyle="black",o.textAlign="center",o.fillText(s,200,250);let n=await (0,g.loadImage)(e);o.drawImage(n,100,280,200,200);let a=h().join(process.cwd(),"public",S),u=c().createWriteStream(a);t.createPNGStream().pipe(u),u.on("finish",async()=>{await i.Z.query(`UPDATE users SET ${q.join(", ")} WHERE id = ?`,j),r.status(200).json({message:"Profile saved and QR code generated!"})})}catch(e){console.error("Error generating QR code or saving profile:",e),r.status(500).json({error:"Error generating QR code or saving profile"})}})}let b=(0,a.l)(o,"default"),w=(0,a.l)(o,"config"),A=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/update-user",pathname:"/api/update-user",bundlePath:"",filename:""},userland:o})},9489:(e,r,t)=>{t.d(r,{Z:()=>a});let o=require("multer");var s=t.n(o);let n=s().diskStorage({destination:function(e,r,t){t(null,"./public/uploads")},filename:function(e,r,t){t(null,Date.now()+"-"+r.originalname)}}),a=s()({storage:n})},188:(e,r,t)=>{t.d(r,{Z:()=>n});let o=require("mysql2/promise"),s=t.n(o)().createPool({host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME});(async function(){try{await s.getConnection(),console.log("Connected to the database")}catch(e){console.error("Failed to connect to the database ==>",e)}})();let n=s},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1145);module.exports=t})();